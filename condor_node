#!/usr/bin/perl

use File::Basename;

my $node_name = $ARGV[0];
my $config_dir = "/etc/puppet/modules/condor/node_configs";

if (! -f "$config_dir/$node_name" )
{
   exit 0;
}
else
{
   @config = `cat $config_dir/$node_name`;
}

print "---\n";
print "classes:\n";
print "  - condor::condor\n";
#print "  - condor::postgresql\n";
print "parameters:\n";
print "  node_name: $node_name\n";
foreach (@config)
{
   if (/^([\S]+)\s*=\s*([\S]+)$/)
   {
      print "  $1: $2\n";
   }
   elsif (/^([\S]+)\s*=\s*$/)
   {
      print "  $1:\n";
   }
   elsif (/^([\S]+)$/)
   {
      print "  $1: True\n";
      if ($1 eq "ha_central_manager")
      {
         my $list = "$node_name";
         # Generate the list of other Central Managers
         @files = `grep -H ha_central_manager $config_dir/*`;
         foreach (@files)
         {
            /^(.+):.+$/;
            my $filename = fileparse($1);
            if ($filename ne $node_name)
            {
               $list = $list . ",$filename";
            }
         }
         print "  cm_list: $list\n";
      }
   }
}
#print "  dedicated_resource: true\n";
#print "  dedicated_scheduler: true\n";
#print "  dedicated_preemption: true\n";
#print "  ha_scheduler: true\n";
#print "  ha_central_manager: true\n";
#print "  low_latency: true\n";
#print "  ec2: true\n";
#print "  ec2e: true\n";
#print "  concurrency_limits: true\n";
#print "  dbserver: true\n";
#print "  quill: true\n";
#print "  dbmsd: true\n";
#print "  viewserver: true\n";
#print "  sharedfs: /mnt/sharedfs\n";
#print "  cm_list: $node_name\n";
#print "  dedicatedscheduler: ibm-crichton-02.rhts.bos.redhat.com\n";
#print "  limits: x_limit=10,y_limit=1,z_limit=200\n";
#print "  limits:\n";
#print "  exchange: amq.direct\n";
#print "  broker_ip: 10.1.1.1\n";
#print "  broker_port: 5672\n";
#print "  amqp_queue: grid\n";
#print "  ll_daemon_port: 10000\n";
#print "  ll_connections: 5\n";
#print "  ll_lease_time: 25\n";
#print "  ll_check_interval: 5\n";
#print "  ec2e_route_small: true\n";
#print "  ec2es_pub_key: pub_key\n";
#print "  ec2es_priv_key: priv_key\n";
#print "  ec2es_access_key:\n";
#print "  ec2es_secret_key:\n";
#print "  ec2es_rsapub_key: \n";
#print "  ec2es_bucket: bucket\n";
#print "  ec2es_queue: queue\n";
#print "  ec2es_amiid: 14\n";
#print "  ec2e_route_hcmedium:\n";
#print "  ec2e_route_hcelarge:\n";
#print "  ec2e_route_xlarge:\n";
#print "  ec2e_route_large:\n";
#print "  qr_subnets: 10.1.0.0 255.255.0.0, 192.168.2.0 255.255.255.0\n";
#print "  qw_subnets: 192.168.5.0 255.255.255.0\n";
#print "  qrpw: fAd!@)(*&%\$\n";
#print "  qwpw: fAd!@()*&%\$\n";
#print "  node_name: $node_name\n";
#print "  db_node_name: $node_name\n";

exit 0;
